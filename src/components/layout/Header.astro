---
interface Props {
  currentPath?: string;
}

const { currentPath = '/' } = Astro.props;

const navLinks = [
  { label: 'Inicio', href: '/' },
  { label: 'Especialistas', href: '/#especialistas' },
  { label: 'Servicios', href: '/servicios' },
  { label: 'Sobre nosotros', href: '/nosotros' },
  { label: 'Contacto', href: '/contacto' },
];

const isActive = (href: string) => {
  // Hash links (like /#especialistas) are never marked as active
  if (href.includes('#')) return false;

  // Home page - exact match only
  if (href === '/') return currentPath === '/';

  // For other pages, exact match
  return currentPath === href;
};
---

<header
  id="main-header"
  class="bg-white/95 backdrop-blur-md sticky top-0 z-50 transition-all duration-300 border-b border-transparent"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-20">
      <!-- Logo -->
      <a href="/" class="flex-shrink-0 transition-all duration-300 hover:scale-105 hover:drop-shadow-lg">
        <img
          src="https://darkviolet-chough-405570.hostingersite.com/wp-content/uploads/2025/09/logo.png"
          alt="CMEO Especialistas"
          class="h-16 w-auto object-contain"
        />
      </a>

      <!-- Desktop Navigation -->
      <nav class="hidden lg:flex items-center gap-2">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class:list={[
              'relative px-4 py-2 text-sm font-medium text-gray-600 rounded-full',
              'hover:text-brand-green-600 hover:bg-brand-green-50/80',
              'transition-all duration-300',
              isActive(link.href) && 'text-brand-green-600 bg-brand-green-50'
            ]}
          >
            {link.label}
          </a>
        ))}
        <a
          href="/contacto"
          class="ml-4 inline-flex items-center gap-2 px-5 py-2.5 whitespace-nowrap
                 bg-gradient-to-r from-brand-green-500 to-brand-green-600
                 text-white text-sm font-semibold rounded-full
                 shadow-elevation-2 hover:shadow-green-glow
                 hover:-translate-y-0.5 transition-all duration-300"
        >
          Agenda tu cita
          <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
      </nav>

      <!-- Mobile Menu Toggle -->
      <button
        id="menu-toggle"
        class="lg:hidden p-2.5 -mr-2 text-gray-700 hover:text-brand-green-600
               hover:bg-brand-green-50 rounded-xl
               transition-all duration-300 focus:outline-none focus-visible:ring-2
               focus-visible:ring-brand-green-500 focus-visible:ring-offset-2"
        aria-expanded="false"
        aria-controls="mobile-menu"
        aria-label="Abrir menu de navegacion"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu Panel -->
  <div
    id="mobile-menu"
    class="lg:hidden fixed inset-0 z-[60] pointer-events-none"
    aria-hidden="true"
  >
    <!-- Backdrop with blur -->
    <div
      id="menu-backdrop"
      class="absolute inset-0 bg-black/40 backdrop-blur-sm opacity-0 transition-all duration-300"
    ></div>

    <!-- Panel with glass effect -->
    <div
      id="menu-panel"
      class="absolute top-0 right-0 h-full w-[min(85vw,340px)] bg-white/95 backdrop-blur-xl shadow-soft-xl
             translate-x-full transition-transform duration-300 ease-out"
    >
      <!-- Close button -->
      <div class="flex justify-between items-center p-5 border-b border-gray-100/80">
        <span class="text-sm font-semibold text-gray-400 uppercase tracking-wider">Menu</span>
        <button
          id="close-menu"
          class="p-2.5 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-xl
                 transition-all duration-300
                 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-green-500"
          aria-label="Cerrar menu"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Navigation links -->
      <nav class="flex flex-col p-5 gap-1">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class:list={[
              'py-3.5 px-4 text-base font-medium text-gray-700 rounded-xl',
              'hover:bg-gradient-to-r hover:from-brand-green-50 hover:to-transparent',
              'hover:text-brand-green-600 hover:pl-5',
              'transition-all duration-300',
              'focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-green-500',
              isActive(link.href) && 'text-brand-green-600 bg-brand-green-50 font-semibold'
            ]}
          >
            {link.label}
          </a>
        ))}

        <div class="mt-6 pt-6 border-t border-gray-100">
          <a
            href="/contacto"
            class="btn btn-primary btn-lg w-full justify-center"
          >
            <span>Agenda tu cita</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
            </svg>
          </a>
        </div>

        <!-- Contact info in mobile -->
        <div class="mt-8 pt-6 border-t border-gray-100">
          <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">Contacto rapido</p>
          <a href="tel:+576068865077" class="flex items-center gap-3 py-2 text-sm text-gray-600 hover:text-brand-green-600 transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
            </svg>
            (606) 886 5077
          </a>
          <a href="https://wa.me/573143696560" class="flex items-center gap-3 py-2 text-sm text-gray-600 hover:text-brand-green-600 transition-colors">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
            </svg>
            WhatsApp
          </a>
        </div>
      </nav>
    </div>
  </div>
</header>

<script>
  function initHeaderScroll() {
    const header = document.getElementById('main-header');
    if (!header) return;

    let lastScroll = 0;

    const handleScroll = () => {
      const currentScroll = window.scrollY;

      if (currentScroll > 20) {
        header.classList.add('shadow-soft', 'border-gray-100/50');
        header.classList.remove('border-transparent');
      } else {
        header.classList.remove('shadow-soft', 'border-gray-100/50');
        header.classList.add('border-transparent');
      }

      lastScroll = currentScroll;
    };

    window.addEventListener('scroll', handleScroll, { passive: true });
    handleScroll();
  }

  function initMobileMenu() {
    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuPanel = document.getElementById('menu-panel');
    const backdrop = document.getElementById('menu-backdrop');
    const closeBtn = document.getElementById('close-menu');

    if (!menuToggle || !mobileMenu || !menuPanel || !backdrop || !closeBtn) return;

    let isOpen = false;

    const openMenu = () => {
      isOpen = true;
      mobileMenu.classList.remove('pointer-events-none');
      mobileMenu.setAttribute('aria-hidden', 'false');
      menuToggle.setAttribute('aria-expanded', 'true');

      requestAnimationFrame(() => {
        backdrop.classList.add('opacity-100');
        backdrop.classList.remove('opacity-0');
        menuPanel.classList.remove('translate-x-full');
      });

      document.body.classList.add('overflow-hidden');
    };

    const closeMenu = () => {
      isOpen = false;
      menuPanel.classList.add('translate-x-full');
      backdrop.classList.remove('opacity-100');
      backdrop.classList.add('opacity-0');
      menuToggle.setAttribute('aria-expanded', 'false');
      document.body.classList.remove('overflow-hidden');

      setTimeout(() => {
        mobileMenu.classList.add('pointer-events-none');
        mobileMenu.setAttribute('aria-hidden', 'true');
      }, 300);
    };

    menuToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      isOpen ? closeMenu() : openMenu();
    });

    closeBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      closeMenu();
    });

    backdrop.addEventListener('click', closeMenu);

    menuPanel.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', closeMenu);
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isOpen) closeMenu();
    });
  }

  // Initialize on page load and Astro page transitions
  initMobileMenu();
  initHeaderScroll();
  document.addEventListener('astro:page-load', () => {
    initMobileMenu();
    initHeaderScroll();
  });
</script>
