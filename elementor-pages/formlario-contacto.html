<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CMEO - Especialistas</title>
    <link
      rel="icon"
      type="image/png"
      href="/https://cmeo.com.co/wp-content/uploads/2025/09/favicon.png"
    />
    <link rel="stylesheet" href="styles.css" />
    <!-- Google Fonts: Poppins -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    [wpcode id="98"]
    <section class="bg-white py-20 px-6 mt-5" id="contacto">
      <div class="max-w-7xl mx-auto">
        <h2 class="text-3xl font-semibold text-center text-gray-800 mb-12">
          Cont√°ctanos
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-stretch">
          <!-- Formulario primero en m√≥vil -->
          <div
            class="order-1 md:order-none bg-gray-200 p-8 rounded-xl shadow-lg flex flex-col justify-center"
          >
            <form id="contactForm" class="space-y-4 h-full flex flex-col justify-between">
              <div class="space-y-4">
                <input
                  type="text"
                  id="nombre"
                  name="nombre"
                  placeholder="Nombre"
                  required
                  class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-600"
                />
                <input
                  type="email"
                  id="email"
                  name="email"
                  placeholder="Correo"
                  required
                  class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-600"
                />
                <input
                  type="tel"
                  id="telefono"
                  name="telefono"
                  placeholder="Tel√©fono"
                  class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-600"
                />
                <select
                  id="especialidad"
                  name="especialidad"
                  required
                  class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-600 bg-white text-gray-700"
                >
                  <option value="" disabled selected>Selecciona tu inter√©s</option>
                  <option value="Otorrinolaringolog√≠a">Otorrinolaringolog√≠a</option>
                  <option value="Oftalmolog√≠a">Oftalmolog√≠a</option>
                </select>
                <textarea
                  id="mensaje"
                  name="mensaje"
                  placeholder="Mensaje"
                  rows="5"
                  required
                  class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-600"
                ></textarea>
              </div>
              <button
                type="submit"
                id="submitBtn"
                class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-md transition disabled:bg-gray-400 disabled:cursor-not-allowed"
              >
                Enviar
              </button>
            </form>
            
            <!-- Mensaje de estado -->
            <div id="statusMessage" class="mt-4 p-3 rounded-md hidden">
            </div>
          </div>
          <!-- Mapa (segundo en m√≥vil) -->
          <div
            class="order-2 md:order-none rounded-xl overflow-hidden shadow-lg"
          >
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3966.9299507615087!2d-75.3787157!3d6.1401126!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8e469f1878ecc90d%3A0x771d3ead2fb33ed9!2sCity%20Medica!5e0!3m2!1ses!2spl!4v1750949778770!5m2!1ses!2spl"
              width="100%"
              height="100%"
              class="w-full h-full min-h-[450px]"
              style="border: 0"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
            ></iframe>
          </div>
        </div>
      </div>
    </section>

    <script>
      // Funci√≥n para obtener par√°metros de URL
      function getURLParameter(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
      }

      // Funci√≥n para configurar la especialidad seg√∫n el par√°metro URL
      function setEspecialidadFromURL() {
        const especialidadParam = getURLParameter('especialidad');
        const selectEspecialidad = document.getElementById('especialidad');
        
        if (especialidadParam) {
          let especialidadValue = '';
          
          // Mapear los valores del par√°metro a los valores del select
          switch(especialidadParam.toLowerCase()) {
            case 'otorrino':
              especialidadValue = 'Otorrinolaringolog√≠a';
              break;
            case 'oftalmo':
              especialidadValue = 'Oftalmolog√≠a';
              break;
          }
          
          // Si encontramos una especialidad v√°lida, seleccionarla
          if (especialidadValue) {
            selectEspecialidad.value = especialidadValue;
            
            // Remover el atributo disabled y selected de la opci√≥n por defecto
            const defaultOption = selectEspecialidad.querySelector('option[value=""]');
            if (defaultOption) {
              defaultOption.selected = false;
            }
          }
        }
      }

      // Ejecutar cuando el DOM est√© cargado
      document.addEventListener('DOMContentLoaded', function() {
        setEspecialidadFromURL();
      });

      document.getElementById('contactForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const submitBtn = document.getElementById('submitBtn');
        const statusMessage = document.getElementById('statusMessage');
        
        // Deshabilitar bot√≥n y mostrar estado de carga
        submitBtn.disabled = true;
        submitBtn.textContent = 'Enviando...';
        
        // Obtener datos del formulario
        const formData = {
          // Campos de usuario (llenos)
          Name: document.getElementById('nombre').value,
          Email: document.getElementById('email').value,
          Telefono: document.getElementById('telefono').value,
          Especialidad: document.getElementById('especialidad').value,
          'Service Type': 'Contacto Web',
          Origin: 'cmeo.com.co',
          
          // Campos de campa√±a (vac√≠os como solicitaste)
          'Utm Term': '',
          'Utm Source': '',
          'Utm Medium': '',
          'Utm Content': '',
          'Utm Campaign': '',
          
          // Campos adicionales
          Gclid: '',
          Fclid: '',
          Dclid: document.getElementById('mensaje').value // Usar el mensaje como Dclid
        };
        
        try {
          const response = await fetch('https://connect.pabbly.com/workflow/sendwebhookdata/IjU3NjYwNTZkMDYzNDA0MzY1MjY5NTUzNjUxMzci_pc', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
          });
          
          if (response.ok) {
            // √âxito
            statusMessage.className = 'mt-4 p-3 rounded-md bg-green-100 text-green-800 border border-green-200';
            statusMessage.textContent = '¬°Mensaje enviado correctamente! Te contactaremos pronto.';
            statusMessage.classList.remove('hidden');
            
            
            // üîπ Disparo del evento hacia Google Tag Manager
              window.dataLayer = window.dataLayer || [];
              window.dataLayer.push({
                event: 'wpforms_submit',
                'attributes.response.data': 'wpforms-confirmation',
                formName: 'Formulario Principal',
                pagePath: window.location.pathname
              });
            
            // Limpiar formulario
            document.getElementById('contactForm').reset();
            
            // Reestablecer especialidad si vino por URL
            setEspecialidadFromURL();
          } else {
            throw new Error('Error en la respuesta del servidor');
          }
          
        } catch (error) {
          console.error('Error:', error);
          statusMessage.className = 'mt-4 p-3 rounded-md bg-red-100 text-red-800 border border-red-200';
          statusMessage.textContent = 'Hubo un error al enviar el mensaje. Por favor, intenta nuevamente.';
          statusMessage.classList.remove('hidden');
        } finally {
          // Rehabilitar bot√≥n
          submitBtn.disabled = false;
          submitBtn.textContent = 'Enviar';
          
          // Ocultar mensaje despu√©s de 5 segundos
          setTimeout(() => {
            statusMessage.classList.add('hidden');
          }, 5000);
        }
      });
    </script>
    
    [wpcode id="126"]
  </body>
</html>